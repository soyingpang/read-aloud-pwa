<!doctype html>
<html lang="zh-Hant" data-theme="dark" data-font="m">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>章節朗讀</title>

  <script>
    window.BUILD_ID = "2026-02-14-1";
  </script>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0b1220" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <link rel="stylesheet" href="styles.css?v=2026-02-14-1" />
</head>

<body>
  <header class="topbar" role="banner">
    <button id="btnOpenLibrary" class="iconBtn" type="button" aria-label="打開書庫">
      <span class="icon" aria-hidden="true">📚</span>
      <span class="label">書庫</span>
    </button>

    <div class="titleBlock">
      <div class="appTitle">章節朗讀</div>
      <div id="nowTitle" class="appSub">未選章節</div>
    </div>

    <div class="topActions">
      <button id="btnShare" class="iconBtn" type="button" aria-label="分享連結">
        <span class="icon" aria-hidden="true">🔗</span>
        <span class="label">分享</span>
      </button>

      <button id="btnOpenSettings" class="iconBtn" type="button" aria-label="打開設定">
        <span class="icon" aria-hidden="true">⚙️</span>
        <span class="label">設定</span>
      </button>
    </div>
  </header>

  <div class="layout">
    <aside id="libraryPane" class="pane" aria-label="書庫" aria-hidden="false">
      <div class="paneHeader">
        <div class="paneTitle">書庫</div>
        <button id="btnCloseLibrary" class="closeBtn" type="button" aria-label="關閉書庫">✕</button>
      </div>

      <div class="paneSearch">
        <input id="search" class="input" type="search" placeholder="搜尋書名 / 章節" autocomplete="off" />
        <div class="paneTabs" role="tablist" aria-label="書庫分頁">
          <button id="tabBooks" class="tab active" type="button" role="tab" aria-selected="true">書籍</button>
          <button id="tabChapters" class="tab" type="button" role="tab" aria-selected="false" disabled>章節</button>
        </div>
      </div>

      <div class="paneBody" role="region" aria-label="書庫內容">
        <div id="bookList" class="list">載入中…</div>
        <div id="chapterList" class="list hidden">請先選一本書</div>
      </div>

      <div class="paneFooter">
        <div class="metaLine">
          <span class="badge">v<span id="buildId">2026-02-14-1</span></span>
          <span class="muted">通用版（手機/桌機）</span>
        </div>
        <button id="btnCloseLibraryBottom" class="btn w100" type="button">完成</button>
      </div>
    </aside>

    <main class="main" role="main">
      <section class="card hero" aria-label="播放器">
        <div class="heroTop">
          <div class="heroTitle" id="heroBook">請先選擇書籍與章節</div>
          <div class="heroSub" id="heroChapter">可用連結直達：?book=about-face-3&ch=ch-01&autoplay=1</div>
        </div>

        <div class="heroControls">
          <button id="btnMain" class="btn primary big" type="button">播放</button>

          <div class="row">
            <button id="btnRestart" class="btn" type="button" disabled>從頭</button>
            <button id="btnStop" class="btn danger" type="button" disabled>停止</button>
            <button id="btnOpenLibrary2" class="btn ghost" type="button">選書/選章</button>
          </div>
        </div>

        <div class="heroMeta" aria-label="播放狀態">
          <div class="pill" id="metrics">字數：0｜內部分段：0</div>
          <div class="pill" id="progress">0 / 0</div>
          <div class="pill hidden" id="sleepPill">⏲ --:--</div>
        </div>
      </section>

      <section class="card" aria-label="文字內容">
        <div class="cardTitleRow">
          <div class="cardTitle">文字內容</div>
          <div class="cardHint">載入章節後可直接播放，也可自行貼上文字</div>
        </div>

        <textarea id="text" class="textarea" placeholder="在此貼上文字，或從書庫載入章節…" spellcheck="false"></textarea>

        <div class="row mt12">
          <button id="btnPlayCursor" class="btn" type="button">從游標播放</button>
          <button id="btnClear" class="btn ghost" type="button">清空</button>
          <div class="spacer"></div>
          <span id="where" class="muted">—</span>
        </div>
      </section>

      <footer class="footer">
        使用瀏覽器內建朗讀（Speech Synthesis）。手機通常需要點一下才可開始播放。
      </footer>
    </main>
  </div>

  <div id="overlay" class="overlay hidden" aria-hidden="true"></div>

  <section id="settingsModal" class="modal hidden" role="dialog" aria-modal="true" aria-label="設定" aria-hidden="true">
    <div class="modalHeader">
      <div class="modalTitle">設定</div>
      <button id="btnCloseSettings" class="closeBtn" type="button" aria-label="關閉設定">✕</button>
    </div>

    <div class="modalBody">
      <div class="grid">
        <div class="field">
          <label for="theme">主題</label>
          <select id="theme">
            <option value="dark">深色</option>
            <option value="light">淺色</option>
          </select>
        </div>

        <div class="field">
          <label for="fontSize">字體大小</label>
          <select id="fontSize">
            <option value="s">小</option>
            <option value="m" selected>中</option>
            <option value="l">大</option>
          </select>
        </div>

        <div class="field">
          <label for="sleep">睡眠計時</label>
          <select id="sleep">
            <option value="0" selected>關</option>
            <option value="10">10 分</option>
            <option value="20">20 分</option>
            <option value="30">30 分</option>
          </select>
          <div class="help" id="sleepHint">未啟用</div>
        </div>

        <div class="field">
          <label for="punctMode">標點處理</label>
          <select id="punctMode">
            <option value="A" selected>A（保留停頓，不讀符號）</option>
            <option value="B">B（完全移除標點）</option>
          </select>
          <div class="help">A 較自然；B 會更「一口氣」。</div>
        </div>

        <div class="field span2">
          <label for="voice">聲線</label>
          <select id="voice"></select>
          <div class="help">若列表空白，請稍等 1–3 秒或重新整理。</div>
        </div>

        <div class="field">
          <label for="rate">語速：<span id="rateVal">1.0</span>x</label>
          <input id="rate" type="range" min="0.6" max="1.8" step="0.1" value="1.0" />
        </div>

        <div class="field">
          <label for="vol">音量：<span id="volVal">1.0</span></label>
          <input id="vol" type="range" min="0" max="1" step="0.05" value="1.0" />
        </div>

        <div class="field">
          <label for="pitch">音高：<span id="pitchVal">1.0</span></label>
          <input id="pitch" type="range" min="0.5" max="1.6" step="0.1" value="1.0" />
        </div>

        <div class="field">
          <label for="langHint">語言提示</label>
          <select id="langHint">
            <option value="">自動</option>
            <option value="zh-CN">普通話（zh-CN）</option>
            <option value="zh-TW">中文（zh-TW）</option>
            <option value="en-US">英文（en-US）</option>
          </select>
        </div>
      </div>
    </div>

    <div class="modalFooter">
      <button id="btnDoneSettings" class="btn primary w100" type="button">完成</button>
    </div>
  </section>

  <div id="toast" class="toast hidden" aria-live="polite"></div>

  <noscript>
    <div style="padding:12px;font-family:system-ui;">
      你的瀏覽器已停用 JavaScript，這個頁面需要 JavaScript 才能朗讀。
    </div>
  </noscript>

  <script src="app.js?v=2026-02-14-1"></script>
</body>
</html>
