:root{
  --bg:#0b1020;
  --card: rgba(17, 24, 39, .92);
  --text:#e5e7eb;
  --muted:#94a3b8;
  --border: rgba(148,163,184,.16);

  --btn:#0f172a;
  --pri:#3b82f6;
  --pri2:#2563eb;
  --danger:#ef4444;

  --shadow: 0 14px 34px rgba(0,0,0,.35);

  --r16: 16px;
  --r14: 14px;
  --r12: 12px;

  --safeB: env(safe-area-inset-bottom, 0px);
  --safeT: env(safe-area-inset-top, 0px);

  --readerFont: 16px;
}

html[data-font="s"]{ --readerFont: 15px; }
html[data-font="m"]{ --readerFont: 16px; }
html[data-font="l"]{ --readerFont: 18px; }

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text);
  font-family: system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC","PingFang TC",sans-serif;
  background:
    radial-gradient(900px 520px at 20% -10%, rgba(59,130,246,.28), transparent 55%),
    radial-gradient(900px 520px at 90% 0%, rgba(34,197,94,.20), transparent 55%),
    var(--bg);
}

/* App Bar */
.appbar{
  position: sticky;
  top: 0;
  z-index: 50;
  padding: calc(10px + var(--safeT)) 12px 10px 12px;
  display:flex;
  align-items:center;
  gap:10px;
  background: rgba(11,16,32,.78);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(148,163,184,.12);
}
.iconBtn{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:3px;
  padding:10px 10px;
  min-width:64px;
  border-radius: 14px;
  border:1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.55);
  color: var(--text);
  cursor: pointer;
}
.iconBtn.small{min-width:auto; flex-direction:row; padding:8px 10px}
.iconBtn:hover{border-color: rgba(148,163,184,.30)}
.icon{font-size:18px; line-height:1}
.iconLabel{font-size:11px; color: var(--muted)}
.appbarCenter{flex:1; min-width:0}
.appTitle{font-weight:850; letter-spacing:.3px}
.appSubtitle{
  margin-top:2px;
  font-size:12px;
  color: var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Page */
.page{
  max-width: 720px;
  margin: 0 auto;
  padding: 12px 12px calc(110px + var(--safeB)) 12px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

/* Card */
.card{
  background: var(--card);
  border: 1px solid rgba(148,163,184,.14);
  border-radius: var(--r16);
  padding: 14px;
  box-shadow: var(--shadow);
}
.hero{padding:14px}
.heroRow{display:flex; gap:10px; align-items:flex-start}
.heroText{flex:1; min-width:0}
.heroActions{display:flex; flex-direction:column; gap:8px}
.heroTitle{font-size:16px; font-weight:850; line-height:1.25}
.heroSub{
  margin-top:6px;
  font-size:12px;
  color: var(--muted);
  line-height:1.5;
  word-break:break-word;
}
.metaRow{display:flex; gap:8px; margin-top:12px; flex-wrap:wrap}
.pill{
  font-size:12px;
  color: var(--muted);
  padding:6px 10px;
  border:1px solid rgba(148,163,184,.14);
  border-radius: 999px;
  background: rgba(15,23,42,.45);
}
.hidden{display:none}

/* Buttons */
.btn{
  border:1px solid rgba(148,163,184,.18);
  background: rgba(15,23,42,.6);
  color: var(--text);
  padding: 10px 12px;
  border-radius: var(--r12);
  cursor: pointer;
  font-weight: 750;
}
.btn:hover{border-color: rgba(148,163,184,.35)}
.btn:disabled{opacity:.55; cursor:not-allowed}
.btn.primary{
  background: linear-gradient(180deg,var(--pri),var(--pri2));
  border-color: rgba(59,130,246,.35);
}
.btn.ghost{background: transparent}

/* Details + textarea */
.summary{display:flex; flex-direction:column; gap:4px; cursor:pointer; list-style:none}
summary::-webkit-details-marker{display:none}
.summaryHint{font-size:12px; color: var(--muted)}
.textarea{
  width:100%;
  min-height: 220px;
  resize: vertical;
  margin-top: 10px;
  padding: 12px;
  border-radius: var(--r14);
  border:1px solid rgba(148,163,184,.16);
  background:#0b1220;
  color: var(--text);
  outline:none;
  line-height:1.75;
  font-size: var(--readerFont);
}
.textarea:focus{
  border-color: rgba(59,130,246,.65);
  box-shadow: 0 0 0 4px rgba(59,130,246,.12);
}
.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.mt10{margin-top:10px}
.spacer{flex:1}
.smallMuted{font-size:12px; color:var(--muted)}

/* Segmented controls */
.segBlock{margin-top:12px}
.segTitle{font-size:12px; color:var(--muted); margin-bottom:8px}
.segControl{
  display:flex;
  gap:8px;
  padding: 8px;
  border-radius: 16px;
  border:1px solid rgba(148,163,184,.14);
  background: rgba(15,23,42,.45);
}
.segBtn{
  flex:1;
  padding: 10px 10px;
  border-radius: 14px;
  border:1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.55);
  color: var(--muted);
  font-weight: 850;
  cursor:pointer;
}
.segBtn.active{
  color: var(--text);
  border-color: rgba(59,130,246,.30);
  background: rgba(59,130,246,.14);
}
.tiny{font-size:12px; color:var(--muted); margin-top:8px}

/* Settings grid */
.grid{display:grid; gap:12px; grid-template-columns:1fr; margin-top:12px}
.field label{font-size:12px; color: var(--muted)}
select, input[type="range"]{
  width:100%;
  padding:10px 12px;
  border-radius: var(--r12);
  border:1px solid rgba(148,163,184,.16);
  background:#0b1220;
  color: var(--text);
  outline:none;
}

.footer{
  color: rgba(148,163,184,.85);
  font-size:12px;
  text-align:center;
  padding: 4px 0 0 0;
}

/* Player bar */
.playerBar{
  position: fixed;
  left: 12px;
  right: 12px;
  bottom: calc(12px + var(--safeB));
  z-index: 60;
  display:flex;
  gap:10px;
  padding: 10px;
  border-radius: 18px;
  border:1px solid rgba(148,163,184,.14);
  background: rgba(15,23,42,.82);
  backdrop-filter: blur(14px);
  box-shadow: 0 18px 45px rgba(0,0,0,.45);
}
.pbtn{
  flex:1;
  padding: 14px 10px;
  border-radius: 14px;
  border: 1px solid rgba(148,163,184,.18);
  background: rgba(15,23,42,.6);
  color: var(--text);
  font-weight: 850;
  cursor: pointer;
}
.pbtn.primary{
  background: linear-gradient(180deg,var(--pri),var(--pri2));
  border-color: rgba(59,130,246,.35);
}
.pbtn.danger{
  background: rgba(239,68,68,.16);
  border-color: rgba(239,68,68,.35);
}
.pbtn:disabled{opacity:.55; cursor:not-allowed}

/* Bottom Sheet */
.backdrop{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.55);
  z-index: 70;
}
.sheet{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 80;
  border-top-left-radius: 22px;
  border-top-right-radius: 22px;
  border:1px solid rgba(148,163,184,.14);
  background: rgba(17,24,39,.96);
  box-shadow: 0 -18px 50px rgba(0,0,0,.55);
  max-height: 82vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.sheetHeader{
  display:flex;
  align-items:center;
  gap:10px;
  padding: 12px 12px 10px 12px;
  border-bottom: 1px solid rgba(148,163,184,.12);
}
.sheetTitle{font-weight:900}
.sheetRight{flex:1}
.sheetTabs{
  display:flex;
  gap:8px;
  padding: 10px 12px;
  border-bottom: 1px solid rgba(148,163,184,.12);
}
.tab{
  flex:1;
  padding: 10px 10px;
  border-radius: 14px;
  border:1px solid rgba(148,163,184,.14);
  background: rgba(15,23,42,.55);
  color: var(--muted);
  font-weight: 850;
  cursor:pointer;
}
.tab.active{
  color: var(--text);
  border-color: rgba(59,130,246,.30);
  background: rgba(59,130,246,.14);
}
.sheetBody{padding: 12px; overflow:auto}
.list{display:flex; flex-direction:column; gap:10px}
.item{
  display:flex;
  gap:10px;
  align-items:center;
  padding: 12px 12px;
  border-radius: 16px;
  border:1px solid rgba(148,163,184,.14);
  background: rgba(15,23,42,.45);
}
.itemMain{
  flex:1;
  min-width:0;
  display:flex;
  flex-direction:column;
  gap:4px;
  cursor:pointer;
}
.itemTitle{font-weight: 900; line-height:1.2}
.itemSub{
  font-size:12px;
  color: var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.itemBtn{
  padding:10px 12px;
  border-radius: 14px;
  border:1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.55);
  color: var(--text);
  font-weight: 850;
  cursor:pointer;
}
.itemBtn:hover{border-color: rgba(148,163,184,.30)}

/* Toast */
.toast{
  position: fixed;
  left: 12px;
  right: 12px;
  bottom: calc(92px + var(--safeB));
  z-index: 90;
  padding: 12px 14px;
  border-radius: 16px;
  border: 1px solid rgba(148,163,184,.16);
  background: rgba(15,23,42,.88);
  backdrop-filter: blur(14px);
  color: var(--text);
  box-shadow: 0 18px 45px rgba(0,0,0,.50);
}
